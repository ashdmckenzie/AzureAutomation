$tenantId = "e23d063b-ef42-4496-abe6-b12b0886e210"
$emailAddress = "james@jmsdnh.co.uk"
$username = "James"

$hardCodedToken = "eyJ0eXAiOiJKV1QiLCJub25jZSI6IjViZ3pGSXRBRl9ZdnBRdFFhc2N5ODVaLXdfb1VvR0JUWjB5aUptMFdwa2siLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1yNS1BVWliZkJpaTdOZDFqQmViYXhib1hXMCIsImtpZCI6Ik1yNS1BVWliZkJpaTdOZDFqQmViYXhib1hXMCJ9.eyJhdWQiOiJodHRwczovL2dyYXBoLm1pY3Jvc29mdC5jb20vIiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy5uZXQvZTIzZDA2M2ItZWY0Mi00NDk2LWFiZTYtYjEyYjA4ODZlMjEwLyIsImlhdCI6MTY0MzY0NDQwNSwibmJmIjoxNjQzNjQ0NDA1LCJleHAiOjE2NDM2NDk1NzksImFjY3QiOjAsImFjciI6IjEiLCJhaW8iOiJFMlpnWUNnTW5Ec251UE9mOUZQbnc2ZDN1dm9HcU1ueVhUekpxdGpqMUcrOWZMSjZmdzhBIiwiYW1yIjpbInB3ZCJdLCJhcHBfZGlzcGxheW5hbWUiOiJBREliaXphVVgiLCJhcHBpZCI6Ijc0NjU4MTM2LTE0ZWMtNDYzMC1hZDliLTI2ZTE2MGZmMGZjNiIsImFwcGlkYWNyIjoiMiIsImNvbnRyb2xzIjpbImNhX2VuZiJdLCJkZXZpY2VpZCI6IjhkZjI2Zjk5LWVjMWEtNGRjOS05ZDhkLTczMGU1YmFjN2U5ZCIsImdpdmVuX25hbWUiOiJBZG1pbiIsImlkdHlwIjoidXNlciIsImlwYWRkciI6IjUuNzAuNTAuMTE2IiwibmFtZSI6IkFkbWluIiwib2lkIjoiOThhYzllN2ItNDU1MS00MDM4LTk3MDktM2Q1ZTMxZjg4YWU2IiwicGxhdGYiOiIzIiwicHVpZCI6IjEwMDMyMDAwRDIzMjY5QzMiLCJwd2RfZXhwIjoiMTE0OTE2NyIsInB3ZF91cmwiOiJodHRwczovL3BvcnRhbC5taWNyb3NvZnRvbmxpbmUuY29tL0NoYW5nZVBhc3N3b3JkLmFzcHgiLCJyaCI6IjAuQVY0QU93WTk0a0x2bGtTcjVyRXJDSWJpRUFNQUFBQUFBQUFBd0FBQUFBQUFBQUJlQUY0LiIsInNjcCI6IkFjY2Vzc1Jldmlldy5SZWFkV3JpdGUuQWxsIEF1ZGl0TG9nLlJlYWQuQWxsIERpcmVjdG9yeS5BY2Nlc3NBc1VzZXIuQWxsIERpcmVjdG9yeS5SZWFkLkFsbCBEaXJlY3RvcnkuUmVhZFdyaXRlLkFsbCBlbWFpbCBFbnRpdGxlbWVudE1hbmFnZW1lbnQuUmVhZC5BbGwgR3JvdXAuUmVhZFdyaXRlLkFsbCBJZGVudGl0eVByb3ZpZGVyLlJlYWRXcml0ZS5BbGwgSWRlbnRpdHlSaXNrRXZlbnQuUmVhZFdyaXRlLkFsbCBJZGVudGl0eVVzZXJGbG93LlJlYWQuQWxsIG9wZW5pZCBQb2xpY3kuUmVhZC5BbGwgUG9saWN5LlJlYWRXcml0ZS5BdXRoZW50aWNhdGlvbkZsb3dzIFBvbGljeS5SZWFkV3JpdGUuQXV0aGVudGljYXRpb25NZXRob2QgUG9saWN5LlJlYWRXcml0ZS5Db25kaXRpb25hbEFjY2VzcyBwcm9maWxlIFJlcG9ydHMuUmVhZC5BbGwgUm9sZU1hbmFnZW1lbnQuUmVhZFdyaXRlLkRpcmVjdG9yeSBTZWN1cml0eUV2ZW50cy5SZWFkV3JpdGUuQWxsIFRydXN0RnJhbWV3b3JrS2V5U2V0LlJlYWQuQWxsIFVzZXIuRXhwb3J0LkFsbCBVc2VyLlJlYWRXcml0ZS5BbGwgVXNlckF1dGhlbnRpY2F0aW9uTWV0aG9kLlJlYWRXcml0ZS5BbGwiLCJzaWduaW5fc3RhdGUiOlsiZHZjX21uZ2QiLCJkdmNfY21wIl0sInN1YiI6Ik8zaWJlbUEtUTl3bnpuakhLSmtUb2hBM3B5RFVpQjNhSkNpNUwxbklRNFUiLCJ0ZW5hbnRfcmVnaW9uX3Njb3BlIjoiRVUiLCJ0aWQiOiJlMjNkMDYzYi1lZjQyLTQ0OTYtYWJlNi1iMTJiMDg4NmUyMTAiLCJ1bmlxdWVfbmFtZSI6ImFkbWluQHBob25kZW50cy5vbm1pY3Jvc29mdC5jb20iLCJ1cG4iOiJhZG1pbkBwaG9uZGVudHMub25taWNyb3NvZnQuY29tIiwidXRpIjoibjgzYzhEZHR5MFNKZS1XY0ZSRmJBQSIsInZlciI6IjEuMCIsIndpZHMiOlsiNjJlOTAzOTQtNjlmNS00MjM3LTkxOTAtMDEyMTc3MTQ1ZTEwIiwiYjc5ZmJmNGQtM2VmOS00Njg5LTgxNDMtNzZiMTk0ZTg1NTA5Il0sInhtc19zdCI6eyJzdWIiOiJjWWlpMlYwSjk4WXluR3FrVW1tZ1FpbE1pSzR3eHBTbWk4c1RmR18wbXlvIn0sInhtc190Y2R0IjoxNTk1NDE0NjYwfQ.xcr3yXoKfxkhUR44n6Fzkg2zjYP704EUGfU-O1V9WYjdDrysWec5Q7M4Axol8DfMnXgEEL1w325WSTieaZjZ_XK9qLZkOAKjjM_os7nKk85Z1ZwOfR458XP_kppv7mgIzX_Qq5H5Qdu5KFLUjr5TxPrLWWM_NX0nIuDZ7Ma0pth581-v_LTmy7NlwIowaLLLMD3FhN68uSmEqchv1wC8tWfxRfYwoDfH0vbKSQ1ELL6VzLocg-K1QBeP-KSrdHJdls6ttucYmTRVBW5jEu8WxsEu-oacsl7KG5-_ICO7uSlWVq8quEDQCpDXlaE0wKcKSXzrF6bb790wHE071kFaTA"
$expiresOn = [DateTimeOffset] (Get-Date).AddSeconds(3600)
$token = @{
    'Authorization' = "Bearer $($hardCodedToken)"
    'Content-Type'  = "Application/json"
    'ExpiresOn'     = $expiresOn
}

$uri = "https://graph.microsoft.com/v1.0/invitations?lang=en-us"

$body = [PSCustomObject]@{
    invitedUserEmailAddress = $emailAddress
    invitedUserDisplayname  = $username
    inviteRedirectUrl       = "https://account.activedirectory.windowsazure.com/?tenantid=$tenantId&login_hint=$emailAddress"
    sendInvitationMessage   = "true"
    invitedUserType         = "Guest"

} | ConvertTo-Json

Invoke-RestMethod -Method Post -Uri $uri -Headers $token -Body $body -ContentType "Application/json"
